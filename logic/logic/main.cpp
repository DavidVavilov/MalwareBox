#include <iostream>
#include <string> 
#include "ProcessInformation.h"
#include "atlstr.h"
#include <thread> 
#include "EventSinkCreationEvent.h"
#include "EventSinkDeletionEvent.h"
#include "Helper.h"
#include "Logger.h"
#include "StaticScans.h"
#include "ProcessScan.h"
#include "PacketScan.h"
#include "RegistryScan.h"

//argv contains file name
int main(int argc, char* argv[])
{
    if (argc > 1)
    {
        Logger::WriteLogToFile(StaticScans::runStringsScan(argv[1]), STRINGS_FILE);
        
        Logger::WriteLogToFile(StaticScans::runVirusTotalScan(argv[1]), VIRUSTOTAL_FILE);

        Logger::WriteLogToFile(StaticScans::runYaraScan(argv[1]), YARA_FILE);

        //convert argv[1] from char* to TCHAR*
        USES_CONVERSION;
        TCHAR* fileName = A2T(argv[1]);

        ProcessInformation opendProcess(fileName);

        RegistryScan registryScan(argv[1]);
        ProcessScan procScan(opendProcess.getPid());
        PacketScan PacketScan(opendProcess.getPid());

        std::thread registryScanThread(&RegistryScan::runScan, registryScan);
        std::thread processScanThread (&ProcessScan::runScan, procScan);
        std::thread packetScanThread (&PacketScan::runScan, PacketScan);
        registryScanThread.join();
        processScanThread.join();
        packetScanThread.join();
    }
	return 0;
}